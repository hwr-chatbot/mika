VAULTPASS_FILE = ./../vaultpass
VAULT_FILE = .env.enc
ENV_FILE   = .env

init:
	make decrypt
	yarn install
	yarn prisma generate
	make migrate

migrate:
	yarn prisma migrate dev

migration-create:
	@if [ -z "$(name)" ]; then \
		echo "‚ùå Please provide a name: make migration-create name=add_users_table"; \
		exit 1; \
	fi
	yarn prisma migrate dev --name $(name)

decrypt:
	@echo "üîì Decrypting $(VAULT_FILE) into $(ENV_FILE)..."
	ansible-vault decrypt --output $(ENV_FILE) --vault-password-file $(VAULTPASS_FILE) $(VAULT_FILE)

encrypt:
	@echo "üîê Encrypting $(ENV_FILE) into $(VAULT_FILE)..."
	ansible-vault encrypt --output $(VAULT_FILE) --vault-password-file $(VAULTPASS_FILE) $(ENV_FILE)
